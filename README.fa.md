# 🔥 مدیر فایروال ایران

## [Click to view the English version.](README.md)

یک **اسکریپت امن و تعاملی Bash** برای افزایش امنیت سرورهای ایرانی با کنترل دقیق آی‌پی‌ها و پورت‌های مجاز — ایده‌آل برای ستاپ‌های تونلینگ.

> ✅ طراحی‌شده برای تونل‌هایی مانند **Rathole v2**، **Backhaul**، **Xray** یا سیستم‌های پراکسی خصوصی


## 🛡️ ویژگی‌های کلیدی

* ❌ مسدودسازی تمام ترافیک ورودی و خروجی به‌صورت پیش‌فرض
* 🌍 فقط اجازه به آی‌پی سرور خارجی (غیر ایرانی) و پورت‌های مشخص‌شده
* 🔕 غیرفعال‌سازی Ping (ICMP) برای جلوگیری از اسکن
* 💾 ذخیره خودکار قوانین فایروال با `iptables-persistent`
* 🔁 امکان **ریست کامل** قوانین و بازگردانی به حالت باز
* 📱 منوی تعاملی با ایموجی – بدون نیاز به ویرایش اسکریپت
* 🔐 پشتیبانی از قوانین **TCP / UDP / هر دو**
* 🧠 یادآوری **آخرین تنظیمات ذخیره‌شده** (IP + پورت‌ها)
* 🧪 تست اتصال آی‌پی خارجی با **Ping Check**
* 📋 نمایش وضعیت فعلی پورت‌های باز و آی‌پی‌های مجاز
* ✅ کاملاً تعاملی – بدون نیاز به نوشتن دستی قوانین


## 🚀 اجرای سریع با یک خط فرمان

برای اجرای آخرین نسخه‌ی تقویت‌شده (v2)، کافیست دستور زیر را اجرا کنید:

```bash
bash <(curl -Ls https://raw.githubusercontent.com/power0matin/Iran-Firewall-Manager/main/firewall-manager-v2.sh)
```

> ✅ **پیشنهادشده:** شامل تمام ویژگی‌های جدید مثل پشتیبانی از UDP، تست اتصال، ذخیره تنظیمات و نمایش پورت‌ها


### 🧪 نسخه ساده‌تر (v1)

اگر ترجیح می‌دهید از نسخه‌ی ساده‌تر و اولیه استفاده کنید:

```bash
bash <(curl -Ls https://raw.githubusercontent.com/power0matin/Iran-Firewall-Manager/main/firewall-manager.sh)
```

> ⚠️ توجه: این نسخه فاقد منوی پیشرفته، اعتبارسنجی و امکانات اضافی است.


## 📦 نمونه خروجی

```bash
[*] Installing iptables-persistent...
[*] Flushing existing firewall rules...
[*] Allowing localhost traffic...
[*] Allowing SSH on port 22...
[*] Applying rules for IP 1.2.3.4 and allowed ports...
  - Allowing TCP port 443 from 1.2.3.4
  - Allowing UDP port 443 from 1.2.3.4
[*] Setting default policy to DROP...
[*] Disabling ICMP echo (ping)...
[*] Saving iptables rules...
[✅] Firewall rules applied successfully.
```


## 📋 منوی برنامه

```
====== Firewall Management Menu ======
1) Apply secure firewall restrictions
2) Reset firewall to open state
3) Show currently open ports
4) Enable secure mode (allow only selected IP and ports)
0) Exit
```


## ⚠️ هشدارها

> 🛑 **با دقت آی‌پی را وارد کنید!**
> ورود آی‌پی اشتباه ممکن است باعث شود دسترسی SSH به سرور را از دست بدهید. ابتدا تونل را تست کرده و سپس فایروال را فعال کنید.

> 🧠 **نیاز به پورت‌های خاص مثل DNS یا NTP دارید؟**
> می‌توانید قبل از ذخیره‌سازی، دستی اضافه کنید:

```bash
iptables -A OUTPUT -p udp --dport 53 -j ACCEPT  # DNS  
iptables -A OUTPUT -p udp --dport 123 -j ACCEPT # NTP  
```

> 📡 اکنون UDP نیز **پشتیبانی می‌شود**. هنگام استفاده از منو، بین `TCP`، `UDP` یا `هردو` انتخاب کنید.


## 🧱 فازهای پروژه (نقشه راه)

پروژه به‌مرور با ویژگی‌های جدید به‌روزرسانی خواهد شد:

### 🧱 نقشه راه توسعه

| فاز          | وضعیت           | 🔧 قابلیت‌های برنامه‌ریزی‌شده                                                          | ✅ توضیحات                                                       |
| ------------ | --------------- | -------------------------------------------------------------------------------------- | --------------------------------------------------------------- |
| 🟢 **فاز 1** | ✅ انجام شده     | 🔒 قوانین اولیه TCP<br>🌐 سفید کردن آی‌پی<br>🚫 بلاک همه به‌صورت پیش‌فرض               | ساختار پایه با iptables و منوی ساده                             |
| 🟡 **فاز 2** | 🔛 در حال انجام | 📱 منوی پیشرفته<br>📦 پشتیبانی از UDP<br>🧠 یادآوری آخرین تنظیمات<br>🖥️ نمایش پورت‌ها | حالت Secure، ذخیره فایل تنظیمات، UX بهتر                        |
| 🟠 **فاز 3** | 🔜 آینده نزدیک  | ⏱️ بازگردانی خودکار (درصورت قطع)<br>🧪 پروفایل سیستم<br>🌓 حالت روز/شب                 | جلوگیری از قفل شدن، سوئیچ بین مودهای dev/prod، قوانین زمان‌محور |
| 🔵 **فاز 4** | ⏳ برنامه‌ریزی   | 🌍 مسدودسازی GeoIP<br>📅 زمان‌بندی خودکار\<br💬 منوی دو زبانه (EN/FA)                  | فیلتر کشورها، اتوماسیون روزانه، پشتیبانی چندزبانه               |
| 🟣 **فاز 5** | 🧠 پیشرفته      | 📊 مانیتور ترافیک<br>🚨 هشدار تلگرام<br>📥 لاگ خارجی                                   | مشاهده لحظه‌ای، هشدار نفوذ، ارسال لاگ به سرور دیگر              |
| 🟤 **فاز 6** | 🧪 آزمایشی      | 🐳 فایروال هوشمند برای Docker<br>🔗 رابط API<br>👥 لاگ چندکاربره                       | اتصال به داکر، کنترل از راه دور، لاگ دسترسی ادمین‌ها            |

🔧 **فاز فعلی:** `فاز 2` – تمرکز روی منوی تعاملی، ذخیره‌سازی ماندگار و پشتیبانی از UDP
📅 **مرحله بعدی:** اجرای بازگردانی خودکار و پروفایل‌های تنظیماتی در فاز 3

پیشنهاد دارید؟ یک [Issue](https://github.com/power0matin/Iran-Firewall-Manager/issues) باز کنید!


## ⚙️ پیش‌نیازها

* ✅ سیستم‌عامل Ubuntu یا Debian
* 🧑‍💻 دسترسی روت
* 📦 پکیج‌های `iptables` و `iptables-persistent` (به‌صورت خودکار نصب می‌شود)


## ✅ تست‌شده روی

* Ubuntu 20.04 / 22.04
* Debian 11 / 12
* انواع VPS: KVM، NAT، OpenVZ (فقط IPv4)


## 📄 مجوز

[مجوز MIT](LICENSE) – رایگان برای استفاده شخصی، آموزشی یا تجاری.


## ✨ سازنده

ساخته شده با ❤️ توسط [power0matin](https://github.com/power0matin)
اگر براتون مفید بود، لطفاً ریپو رو ⭐ کنید و به دیگران معرفی کنید!
